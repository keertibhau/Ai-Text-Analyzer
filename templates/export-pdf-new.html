<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export PDF Report - AI Analytics Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: rgba(255, 255, 255, 0.9);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-light: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
            bottom: -100px;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Modern Header */
        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            color: white;
            padding: 3rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 200%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1s ease-out;
        }
        
        header p {
            font-size: 1.25rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        /* Modern Navigation */
        .nav {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav .container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--glass-border);
            transform: translateY(-2px);
            color: white;
        }
        
        .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 3rem 0;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            text-align: center;
            margin: 3rem 0 2rem;
            animation: fadeInUp 1s ease-out both;
        }

        /* Modern Cards */
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-light);
            margin: 3rem 0;
            transition: all 0.3s ease;
            animation: fadeInUp 1s ease-out both;
        }
        
        .card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: var(--shadow);
        }

        .card h3 {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .card p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            line-height: 1.7;
        }

        /* Modern Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.2rem;
        }

        .export-section {
            text-align: center;
            margin: 3rem 0;
        }
        
        .preview-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-light);
            margin: 2rem 0;
            transition: all 0.3s ease;
        }
        
        .preview-container:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .preview-container h3 {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 24px;
            text-align: center;
        }

        /* Report Preview */
        .report-container {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 32px 0;
        }

        .report-preview {
            max-width: 900px;
            margin: 0 auto;
            background: white;
        }

        /* Report Header */
        .report-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 48px 32px;
            text-align: center;
            position: relative;
        }

        .report-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'%3E%3Cpath d='M20 20c0 11.046-8.954 20-20 20v20h40V20H20z'/%3E%3C/g%3E%3C/svg%3E");
        }

        .report-header-content {
            position: relative;
            z-index: 2;
        }

        .report-header h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .report-meta {
            display: flex;
            justify-content: center;
            gap: 32px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .report-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        /* Report Content */
        .report-content {
            padding: 48px 32px;
        }

        .report-section {
            margin-bottom: 48px;
        }

        .report-section h3 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .report-section h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 32px 0 16px 0;
        }

        .report-section p {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }

        .metric-card {
            background: var(--light);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .metric-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Progress Bars */
        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-positive { background: linear-gradient(90deg, var(--success), #68d391); }
        .progress-neutral { background: linear-gradient(90deg, var(--warning), #f6ad55); }
        .progress-negative { background: linear-gradient(90deg, var(--danger), #fc8181); }

        /* Topic Tags */
        .topic-section {
            margin: 24px 0;
        }

        .topic-words {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .word-tag {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        /* Images */
        .report-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 24px 0;
            box-shadow: var(--shadow);
        }
        
        /* Improved Wordcloud Styling */
        .wordcloud-section {
            margin: 40px 0;
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }
        
        .wordcloud-item, .wordcloud-topic-item {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }
        
        .wordcloud-item h5, .wordcloud-topic-item h5, .wordcloud-topic-item h6 {
            margin-bottom: 16px;
            color: var(--gray-800);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .wordcloud-image, .wordcloud-image-small, .wordcloud-image-topic {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 0;
            box-shadow: none;
            border: none;
        }
        
        .wordcloud-topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .wordcloud-sentiment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* PDF Layout Optimizations */
        @media print {
            @page {
                size: A4;
                margin: 30mm 8mm; /* 30mm top/bottom blank space, 8mm left/right for maximum width */
            }
            
            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Force page breaks before elements that might get cut */
            .report-section {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: auto;
                margin-bottom: 40px;
                min-height: 60mm; /* Minimum height to trigger page break if not enough space */
            }
            
            .chart-item, .chart-item-wide, .chart-item-center {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: auto;
                margin-bottom: 20px;
                min-height: 80mm; /* Charts need more space */
            }
            
            .wordcloud-item, .wordcloud-topic-item {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: auto;
                margin-bottom: 20px;
                min-height: 70mm; /* Wordclouds need space */
            }
            
            .wordcloud-section {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: auto;
                margin: 30px 0;
            }
            
            .metric-card {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                margin-bottom: 10px;
            }
            
            .charts-grid {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                margin: 30px 0;
            }
            
            .report-header {
                page-break-after: avoid !important;
                margin-bottom: 30px;
            }
            
            /* Images and visual elements */
            img, .report-image {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                max-width: 100%;
                height: auto;
                margin: 10px 0;
            }
            
            /* Headers should stay with content */
            h1, h2, h3, h4, h5, h6 {
                page-break-after: avoid !important;
                break-after: avoid !important;
                page-break-inside: avoid !important;
                orphans: 3;
                widows: 3;
            }
            
            /* Ensure sections have enough space or go to next page */
            .report-section:has(img), 
            .chart-item:has(img),
            .wordcloud-item:has(img) {
                page-break-before: auto;
                min-height: 100mm; /* More space for sections with images */
            }
        }
        
        /* Better content spacing for PDF */
        .pdf-page-break {
            page-break-before: always;
            break-before: page;
        }
        
        .pdf-avoid-break {
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .pdf-section-spacing {
            margin: 32px 0;
            padding: 16px 0;
        }
        
        /* Compact layout for better PDF structure */
        .report-content {
            padding: 24px !important;
        }
        
        .report-section {
            margin-bottom: 40px !important;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .report-section h3 {
            margin-bottom: 20px !important;
            page-break-after: avoid;
            break-after: avoid;
        }
        
        .charts-grid {
            margin: 24px 0 !important;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .chart-item, .chart-item-wide, .chart-item-center {
            margin-bottom: 20px !important;
            page-break-inside: avoid;
            break-inside: avoid;
            padding: 12px;
        }
        
        .wordcloud-section {
            margin: 32px 0 !important;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .wordcloud-item, .wordcloud-topic-item {
            page-break-inside: avoid;
            break-inside: avoid;
            margin-bottom: 16px !important;
        }
        
        .metric-card {
            margin-bottom: 12px !important;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        /* Images with proper constraints to prevent splitting */
        .chart-image, .chart-image-wide, .chart-image-center {
            margin: 12px 0 !important;
            max-height: 240px !important;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .wordcloud-image, .wordcloud-image-small, .wordcloud-image-topic {
            margin: 8px 0 !important;
            max-height: 220px !important;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        /* Better text flow */
        .report-section p {
            margin-bottom: 12px;
            orphans: 3;
            widows: 3;
        }
        
        .report-section h4, .report-section h5 {
            page-break-after: avoid;
            break-after: avoid;
            margin-top: 16px;
            margin-bottom: 8px;
        }

        /* Chart Layouts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }

        .charts-grid-wide {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin: 32px 0;
        }

        .charts-center {
            display: flex;
            justify-content: center;
            margin: 32px 0;
        }

        .chart-item {
            background: var(--light);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .chart-item-wide {
            background: var(--light);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-light);
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .chart-item-center {
            background: var(--light);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-light);
            border: 1px solid #e2e8f0;
            text-align: center;
            max-width: 500px;
        }

        .chart-item h5, .chart-item-wide h5, .chart-item-center h5 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
        }

        .chart-image {
            width: 100%;
            max-width: 350px;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow-light);
            transition: transform 0.2s;
        }

        .chart-image-wide {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow-light);
        }

        .chart-image-center {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow-light);
        }

        /* Word Cloud Layouts */
        .wordcloud-section {
            margin: 40px 0;
        }

        .wordcloud-section h4 {
            font-size: 1.375rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-align: center;
        }

        .wordcloud-container {
            display: flex;
            justify-content: center;
            margin: 24px 0;
        }

        .wordcloud-image {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 2px solid #e2e8f0;
        }

        .wordcloud-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }

        .wordcloud-item {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .wordcloud-item h5 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .wordcloud-image-small {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 8px;
            box-shadow: var(--shadow-light);
        }

        /* Topic Word Clouds */
        .wordcloud-topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .wordcloud-topic-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow-light);
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .wordcloud-topic-item h6 {
            font-size: 0.975rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .wordcloud-image-topic {
            width: 100%;
            max-width: 180px;
            height: auto;
            border-radius: 6px;
            box-shadow: var(--shadow-light);
        }

        /* Report Footer */
        .report-footer {
            background: var(--dark);
            color: white;
            padding: 32px;
            margin-top: 48px;
            text-align: center;
        }

        .report-footer h3 {
            color: white;
            margin-bottom: 16px;
        }

        .report-footer p {
            opacity: 0.8;
            margin-bottom: 12px;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 20px;
            color: var(--primary);
            font-weight: 500;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .page-title h2 { font-size: 2rem; }
            .report-header h2 { font-size: 2rem; }
            .report-meta { flex-direction: column; gap: 16px; }
            .card { padding: 24px 16px; }
            .report-content { padding: 32px 16px; }
            
            /* Chart responsive adjustments */
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .chart-item, .chart-item-wide, .chart-item-center {
                padding: 16px;
            }
            
            .chart-image, .chart-image-wide, .chart-image-center {
                max-width: 100%;
            }
            
            /* Word cloud responsive */
            .wordcloud-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .wordcloud-topics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 12px;
            }
            
            .wordcloud-image {
                max-width: 100%;
            }
            
            .wordcloud-image-small {
                max-width: 100%;
            }
            
            .wordcloud-image-topic {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles"></div>
    
    <!-- Header -->
    <header>
        <div class="container">
            <h1><i class="fas fa-file-pdf"></i> Export PDF Report</h1>
            <p>Generate comprehensive analysis reports in PDF format</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
            <a href="/visualization{{ '/' + filename if filename and filename != 'workspace_analysis' else '' }}" class="nav-link">
                <i class="fas fa-chart-bar"></i> Visualization
            </a>
            <a href="/summary{{ '/' + filename if filename and filename != 'workspace_analysis' else '' }}" class="nav-link">
                <i class="fas fa-file-alt"></i> Summary
            </a>
            <a href="/sentiment{{ '/' + filename if filename and filename != 'workspace_analysis' else '' }}" class="nav-link">
                <i class="fas fa-heart"></i> Sentiment
            </a>
            <a href="/insights{{ '/' + filename if filename and filename != 'workspace_analysis' else '' }}" class="nav-link">
                <i class="fas fa-lightbulb"></i> Insights
            </a>
            <a href="/export-pdf{{ '/' + filename if filename and filename != 'workspace_analysis' else '' }}" class="nav-link active">
                <i class="fas fa-file-pdf"></i> Export PDF
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Page Title -->
            <h2 class="section-title">Export Analysis Report</h2>

            <!-- Export Card -->
            <div class="card">
                <h3><i class="fas fa-magic"></i> Generate PDF Report</h3>
                <p>Create a professional, print-ready report with all your analysis results, visualizations, and insights in a beautifully designed format.</p>
                
                <div class="export-section">
                    <button id="generatePdfBtn" class="btn btn-large">
                        <i class="fas fa-file-pdf"></i>
                        Generate Professional Report
                    </button>
                </div>
            </div>

            <!-- Report Preview -->
            <div class="preview-container">
                <h3>Report Preview</h3>
                <div id="reportContent" class="report-preview">
                    <!-- Report Header -->
                    <div class="report-header">
                        <div class="report-header-content">
                            <h2><i class="fas fa-analytics"></i> Comprehensive Data Analysis Report</h2>
                            <div class="report-meta">
                                <div class="report-meta-item">
                                    <i class="fas fa-file"></i>
                                    <span>{{ filename if filename and filename != 'workspace_analysis' else 'Analysis Dataset' }}</span>
                                </div>
                                <div class="report-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    <span id="currentDate"></span>
                                </div>
                                <div class="report-meta-item">
                                    <i class="fas fa-robot"></i>
                                    <span>AI-Powered Analysis</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Report Content -->
                    <div class="report-content">
                        <!-- Executive Summary -->
                        {% if summary %}
                        <div class="report-section">
                            <h3><i class="fas fa-clipboard-check"></i> Executive Summary</h3>
                            {% set paragraphs = summary.split('\n\n') if summary else [''] %}
                            {% for paragraph in paragraphs %}
                                {% if paragraph.strip() %}
                                    <p>{{ paragraph.strip() }}</p>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Sentiment Analysis -->
                        {% if sentiment_counts and sentiment_counts.values()|sum > 0 %}
                        <div class="report-section">
                            <h3><i class="fas fa-heart"></i> Sentiment Analysis</h3>
                            
                            <div class="metrics-grid">
                                {% set total_sentiment = sentiment_counts.values() | sum %}
                                {% for category, count in sentiment_counts.items() %}
                                    {% if count > 0 %}
                                    <div class="metric-card">
                                        <div class="metric-value">{{ count }}</div>
                                        <div class="metric-label">{{ category }}</div>
                                        <div class="progress-bar">
                                            <div class="progress-fill {% if 'positive' in category.lower() %}progress-positive{% elif 'negative' in category.lower() %}progress-negative{% else %}progress-neutral{% endif %}" 
                                                 style="width: {{ (count / total_sentiment * 100)|round(1) }}%"></div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            {% if sentiment_text and sentiment_text != "No sentiment interpretation available." %}
                            <h4>AI Interpretation</h4>
                            <p>{{ sentiment_text }}</p>
                            {% endif %}

                            {% set sentiment_plot = plots.get('sentiment_distribution') or plots.get('sentiment_dist') or plots.get('sentiment') %}
                            {% if sentiment_plot %}
                            <img src="{{ url_for('serve_static_plot', filename=sentiment_plot.split('\\')[-1].split('/')[-1]) }}" 
                                 alt="Sentiment Distribution" class="report-image">
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Key Insights -->
                        {% if insights and insights != "No insights available." %}
                        <div class="report-section">
                            <h3><i class="fas fa-lightbulb"></i> Key Insights & Recommendations</h3>
                            <p>{{ insights }}</p>
                        </div>
                        {% endif %}

                        <!-- Topic Modeling -->
                        {% if lda_top_words or nmf_top_words %}
                        <div class="report-section">
                            <h3><i class="fas fa-tags"></i> Topic Analysis</h3>
                            
                            {% if lda_top_words %}
                            <h4>Primary Topics (LDA)</h4>
                            {% for topic in lda_top_words[:5] %}
                            <div class="topic-section">
                                <strong>Topic {{ loop.index }}:</strong>
                                <div class="topic-words">
                                    {% for word in topic[:8] %}
                                        {% if word|length >= 3 %}
                                        <span class="word-tag">{{ word }}</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}

                            {% if nmf_top_words %}
                            <h4>Secondary Topics (NMF)</h4>
                            {% for topic in nmf_top_words[:3] %}
                            <div class="topic-section">
                                <strong>Topic {{ loop.index }}:</strong>
                                <div class="topic-words">
                                    {% for word in topic[:8] %}
                                        {% if word|length >= 3 %}
                                        <span class="word-tag">{{ word }}</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Performance Metrics -->
                        {% if classification_metrics %}
                        <div class="report-section">
                            <h3><i class="fas fa-tachometer-alt"></i> Model Performance</h3>
                            <div class="metrics-grid">
                                {% for metric, value in classification_metrics.items() %}
                                <div class="metric-card">
                                    <div class="metric-value">{{ "%.3f"|format(value) if value is number else value }}</div>
                                    <div class="metric-label">{{ metric|replace('_',' ')|title }}</div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Data Distributions -->
                        {% if plots %}
                        <div class="report-section">
                            <h3><i class="fas fa-chart-bar"></i> Data Distributions</h3>
                            
                            <div class="charts-grid">
                                {% if plots.get('sentiment_distribution') %}
                                <div class="chart-item">
                                    <h5>Sentiment Distribution</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('sentiment_distribution').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Sentiment Distribution" class="chart-image">
                                </div>
                                {% endif %}

                                {% if plots.get('difficulty_distribution') %}
                                <div class="chart-item">
                                    <h5>Difficulty Distribution</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('difficulty_distribution').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Difficulty Distribution" class="chart-image">
                                </div>
                                {% endif %}

                                {% if plots.get('attendance_distribution') %}
                                <div class="chart-item">
                                    <h5>Attendance Distribution</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('attendance_distribution').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Attendance Distribution" class="chart-image">
                                </div>
                                {% endif %}

                                {% if plots.get('isSame_distribution') %}
                                <div class="chart-item">
                                    <h5>Category Distribution</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('isSame_distribution').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Category Distribution" class="chart-image">
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Correlation Analysis -->
                        {% set correlation_plot = plots.get('feature_correlation') or plots.get('correlation') or plots.get('feedback_correlation') %}
                        {% if correlation_plot %}
                        <div class="report-section">
                            <h3><i class="fas fa-project-diagram"></i> Correlation Analysis</h3>
                            
                            <div class="charts-grid-wide">
                                {% if plots.get('feature_correlation') %}
                                <div class="chart-item-wide">
                                    <h5>Feature Correlation Matrix</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('feature_correlation').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Feature Correlation Matrix" class="chart-image-wide">
                                </div>
                                {% endif %}

                                {% if plots.get('feedback_correlation') %}
                                <div class="chart-item-wide">
                                    <h5>Feedback Correlation</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('feedback_correlation').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Feedback Correlation" class="chart-image-wide">
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Model Performance -->
                        {% if plots.get('confusion_matrix') %}
                        <div class="report-section">
                            <h3><i class="fas fa-bullseye"></i> Model Performance Analysis</h3>
                            
                            <div class="charts-center">
                                <div class="chart-item-center">
                                    <h5>Confusion Matrix</h5>
                                    <img src="{{ url_for('serve_static_plot', filename=plots.get('confusion_matrix').split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Confusion Matrix" class="chart-image-center">
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Word Cloud Analysis -->
                        {% if plots %}
                        <div class="report-section">
                            <h3><i class="fas fa-cloud"></i> Word Cloud Analysis</h3>
                            
                            <!-- Overall Word Cloud -->
                            {% if plots.get('wordcloud_overall') or plots.get('wordcloud') %}
                            <div class="wordcloud-section">
                                <h4>Overall Text Analysis</h4>
                                <div class="wordcloud-container">
                                    <img src="{{ url_for('serve_static_plot', filename=(plots.get('wordcloud_overall') or plots.get('wordcloud')).split('\\')[-1].split('/')[-1]) }}" 
                                         alt="Overall Word Cloud" class="wordcloud-image">
                                </div>
                            </div>
                            {% endif %}

                            <!-- Sentiment-Based Word Clouds -->
                            {% if plots.get('wordcloud_positive') or plots.get('wordcloud_negative') or plots.get('wordcloud_neutral') %}
                            <div class="wordcloud-section">
                                <h4>Sentiment-Based Analysis</h4>
                                <div class="wordcloud-grid">
                                    {% if plots.get('wordcloud_positive') %}
                                    <div class="wordcloud-item">
                                        <h5><i class="fas fa-smile" style="color: var(--success);"></i> Positive Sentiment</h5>
                                        <img src="{{ url_for('serve_static_plot', filename=plots.get('wordcloud_positive').split('\\')[-1].split('/')[-1]) }}" 
                                             alt="Positive Word Cloud" class="wordcloud-image-small">
                                    </div>
                                    {% endif %}
                                    
                                    {% if plots.get('wordcloud_negative') %}
                                    <div class="wordcloud-item">
                                        <h5><i class="fas fa-frown" style="color: var(--danger);"></i> Negative Sentiment</h5>
                                        <img src="{{ url_for('serve_static_plot', filename=plots.get('wordcloud_negative').split('\\')[-1].split('/')[-1]) }}" 
                                             alt="Negative Word Cloud" class="wordcloud-image-small">
                                    </div>
                                    {% endif %}
                                    
                                    {% if plots.get('wordcloud_neutral') %}
                                    <div class="wordcloud-item">
                                        <h5><i class="fas fa-meh" style="color: var(--warning);"></i> Neutral Sentiment</h5>
                                        <img src="{{ url_for('serve_static_plot', filename=plots.get('wordcloud_neutral').split('\\')[-1].split('/')[-1]) }}" 
                                             alt="Neutral Word Cloud" class="wordcloud-image-small">
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}

                            <!-- Topic-Based Word Clouds -->
                            {% set topic_clouds = [] %}
                            {% for i in range(1, 7) %}
                                {% set topic_cloud = plots.get('wordcloud_topic_' + i|string) %}
                                {% if topic_cloud %}
                                    {% set _ = topic_clouds.append((i, topic_cloud)) %}
                                {% endif %}
                            {% endfor %}
                            
                            {% if topic_clouds %}
                            <div class="wordcloud-section">
                                <h4>Topic-Based Analysis</h4>
                                <div class="wordcloud-topics-grid">
                                    {% for topic_num, cloud_path in topic_clouds[:6] %}
                                    <div class="wordcloud-topic-item">
                                        <h6><i class="fas fa-tag"></i> Topic {{ topic_num }}</h6>
                                        <img src="{{ url_for('serve_static_plot', filename=cloud_path.split('\\')[-1].split('/')[-1]) }}" 
                                             alt="Topic {{ topic_num }} Word Cloud" class="wordcloud-image-topic">
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Report Footer -->
                    <div class="report-footer">
                        <h3>Report Generated by AI Analytics Suite</h3>
                        <p>This comprehensive analysis was generated using advanced machine learning and natural language processing techniques.</p>
                        <p><strong>Generated:</strong> <span id="footerDate"></span></p>
                        {% if filename and filename != "workspace_analysis" %}
                        <p><strong>Source:</strong> {{ filename }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('footerDate').textContent = dateStr;

            // PDF Generation with Smart Page Breaks
            document.getElementById('generatePdfBtn').addEventListener('click', function() {
                const button = this;
                const originalContent = button.innerHTML;
                
                try {
                    // Show loading
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                    button.disabled = true;
                    
                    const reportContent = document.getElementById('reportContent');
                    
                    if (!reportContent) {
                        throw new Error('Report content not found');
                    }
                
                    // Simple and effective anti-cutting approach
                    // Just add basic protection without aggressive manipulation
                    
                    // Add balanced CSS for good layout with cutting protection
                    const styleElement = document.createElement('style');
                    styleElement.innerHTML = `
                        /* Balanced approach - prevent cutting without destroying layout */
                        .report-section {
                            page-break-inside: avoid;
                            margin-bottom: 30px;
                        }
                        
                        .chart-item, .chart-item-wide, .chart-item-center {
                            page-break-inside: avoid;
                            margin-bottom: 25px;
                        }
                        
                        .wordcloud-section {
                            page-break-inside: avoid;
                            margin: 30px 0;
                            padding: 20px;
                            background: white;
                            border-radius: 12px;
                            border: 1px solid #e2e8f0;
                        }
                        
                        .wordcloud-item, .wordcloud-topic-item {
                            page-break-inside: avoid;
                            margin: 20px 0;
                            padding: 15px;
                            background: #f8f9fa;
                            border: 1px solid #dee2e6;
                            border-radius: 8px;
                        }
                        
                        .metric-card {
                            page-break-inside: avoid;
                            margin-bottom: 15px;
                        }
                        
                        .metrics-grid {
                            page-break-inside: avoid;
                            margin: 20px 0;
                        }
                        
                        img, .report-image {
                            page-break-inside: avoid;
                            margin: 15px 0;
                            max-width: 100%;
                            height: auto;
                        }
                        
                        h1, h2, h3, h4, h5, h6 {
                            page-break-after: avoid;
                            margin-bottom: 15px;
                        }
                    `;
                    document.head.appendChild(styleElement);
                    
                    // Enhanced PDF generation with better element handling
                    html2canvas(reportContent, {
                        scale: 1.2,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff',
                        logging: false,
                        onclone: function(clonedDoc) {
                            // Apply styles to cloned document for better PDF layout
                            const clonedStyle = clonedDoc.createElement('style');
                            clonedStyle.innerHTML = `
                                * { box-sizing: border-box; }
                                .report-section {
                                    page-break-inside: avoid !important;
                                    break-inside: avoid !important;
                                    margin-bottom: 40px !important;
                                    padding: 20px 0 !important;
                                }
                                .chart-item, .chart-item-wide, .chart-item-center {
                                    page-break-inside: avoid !important;
                                    break-inside: avoid !important;
                                    margin-bottom: 30px !important;
                                    padding: 15px !important;
                                }
                                .wordcloud-section {
                                    page-break-inside: avoid !important;
                                    break-inside: avoid !important;
                                    background: white !important;
                                    border: 2px solid #e2e8f0 !important;
                                    border-radius: 16px !important;
                                    padding: 30px !important;
                                    margin: 40px 0 !important;
                                }
                                .wordcloud-item, .wordcloud-topic-item {
                                    page-break-inside: avoid !important;
                                    break-inside: avoid !important;
                                    background: #f8f9fa !important;
                                    border: 1px solid #dee2e6 !important;
                                    border-radius: 12px !important;
                                    padding: 20px !important;
                                    margin: 15px 0 !important;
                                }
                                .wordcloud-image, .wordcloud-image-small, .wordcloud-image-topic {
                                    width: 100% !important;
                                    height: auto !important;
                                    max-height: 300px !important;
                                    border-radius: 8px !important;
                                    margin: 10px 0 !important;
                                }
                                img {
                                    page-break-inside: avoid !important;
                                    break-inside: avoid !important;
                                    max-height: 250px !important;
                                }
                                h3, h4, h5, h6 {
                                    page-break-after: avoid !important;
                                    margin-bottom: 15px !important;
                                }
                            `;
                            clonedDoc.head.appendChild(clonedStyle);
                        }
                    }).then(canvas => {
                        // Remove temporary style
                        document.head.removeChild(styleElement);
                        const { jsPDF } = window.jspdf;
                        
                        if (!jsPDF) {
                            throw new Error('jsPDF library not loaded');
                        }
                        
                        // Simplified PDF creation with proper margins
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        const pageWidth = 210; // A4 width in mm
                        const pageHeight = 297; // A4 height in mm
                        
                        // New margin settings: 30mm top/bottom, 8mm left/right
                        const leftMargin = 8;
                        const topMargin = 30;
                        const contentWidth = pageWidth - (2 * leftMargin); // 194mm
                        const contentHeight = pageHeight - (2 * topMargin); // 237mm
                        
                        // Calculate image dimensions to fit in content area
                        const imgWidth = contentWidth;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        // Smart multi-page handling to prevent element cutting
                        if (imgHeight <= contentHeight) {
                            // Single page - fits in content area
                            pdf.addImage(
                                canvas.toDataURL('image/png', 0.9), 
                                'PNG', 
                                leftMargin, 
                                topMargin, 
                                imgWidth, 
                                imgHeight
                            );
                        } else {
                            // Balanced multi-page approach
                            let sourceY = 0;
                            let pageNum = 0;
                            
                            while (sourceY < canvas.height) {
                                if (pageNum > 0) {
                                    pdf.addPage();
                                }
                                
                                const remainingHeight = canvas.height - sourceY;
                                let pageHeight = Math.min(contentHeight, remainingHeight * imgWidth / canvas.width);
                                let sourceHeight = pageHeight * canvas.width / imgWidth;
                                
                                // Small buffer to prevent minor cutting - only 10% reduction
                                if (remainingHeight > sourceHeight + 50 && pageNum < 15) {
                                    pageHeight = pageHeight * 0.9;
                                    sourceHeight = pageHeight * canvas.width / imgWidth;
                                }
                                
                                // Create page canvas
                                const pageCanvas = document.createElement('canvas');
                                pageCanvas.width = canvas.width;
                                pageCanvas.height = Math.min(sourceHeight, remainingHeight);
                                
                                const pageCtx = pageCanvas.getContext('2d');
                                pageCtx.fillStyle = '#ffffff';
                                pageCtx.fillRect(0, 0, pageCanvas.width, pageCanvas.height);
                                
                                pageCtx.drawImage(
                                    canvas,
                                    0, sourceY,
                                    canvas.width, pageCanvas.height,
                                    0, 0,
                                    canvas.width, pageCanvas.height
                                );
                                
                                pdf.addImage(
                                    pageCanvas.toDataURL('image/png', 0.9),
                                    'PNG',
                                    leftMargin,
                                    topMargin,
                                    imgWidth,
                                    pageHeight
                                );
                                
                                sourceY += pageCanvas.height;
                                pageNum++;
                                
                                // Safety break
                                if (pageNum > 20) {
                                    console.warn('PDF generation stopped at 20 pages');
                                    break;
                                }
                            }
                        }
                        
                        // Add metadata and save PDF
                        const now = new Date();
                        const timestamp = now.toISOString().split('T')[0];
                        const filename = `Professional_Analysis_Report_${timestamp}.pdf`;
                        
                        // Add PDF metadata
                        pdf.setProperties({
                            title: 'Professional Data Analysis Report',
                            author: 'AI Analytics Suite',
                            subject: 'Data Analysis Report',
                            creator: 'Data Analytics Dashboard',
                            keywords: 'data analysis, visualization, insights'
                        });
                        
                        pdf.save(filename);
                        
                        // Show success message
                        button.innerHTML = '<i class="fas fa-check"></i> PDF Generated Successfully!';
                        
                        // Create success popup
                        const successDiv = document.createElement('div');
                        successDiv.style.cssText = `
                            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                            background: white; padding: 20px; border-radius: 10px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000;
                            text-align: center; max-width: 400px; border: 2px solid #4ade80;
                        `;
                        successDiv.innerHTML = `
                            <h3 style="color: #4ade80; margin-bottom: 10px;"> PDF Generated Successfully!</h3>
                            <p style="margin-bottom: 15px;">Your professional report has been generated with:</p>
                            <ul style="text-align: left; margin-bottom: 15px; color: #333;">
                                <li> <strong>Smart cutting protection</strong> - Elements prefer to stay together</li>
                                <li> <strong>Clean wordcloud layout</strong> - Proper containers and styling</li>
                                <li> <strong>Protected content blocks</strong> - Reduced chance of splitting</li>
                                <li> <strong>Optimal margins</strong> - 30mm top/bottom, 8mm sides</li>
                                <li> <strong>Professional appearance</strong> - Publication ready</li>
                                <li> <strong>Good content density</strong> - Balanced layout</li>
                            </ul>
                            <p><strong>File:</strong> ${filename}</p>
                            <button onclick="this.parentNode.remove()" style="
                                background: #4ade80; color: white; border: none; 
                                padding: 10px 20px; border-radius: 5px; cursor: pointer;
                                margin-top: 10px;
                            ">Close</button>
                        `;
                        
                        document.body.appendChild(successDiv);
                        
                        setTimeout(() => {
                            button.innerHTML = originalContent;
                            button.disabled = false;
                            if (successDiv.parentNode) successDiv.remove();
                        }, 5000);
                    
                    }).catch(error => {
                        console.error('Error generating PDF:', error);
                        
                        // Show error message
                        button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Generation Failed';
                        
                        const errorDiv = document.createElement('div');
                        errorDiv.style.cssText = `
                            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                            background: white; padding: 20px; border-radius: 10px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000;
                            text-align: center; max-width: 400px; border: 2px solid #f56565;
                        `;
                        errorDiv.innerHTML = `
                            <h3 style="color: #f56565; margin-bottom: 10px;"> PDF Generation Failed</h3>
                            <p style="margin-bottom: 15px;">Please try these solutions:</p>
                            <ul style="text-align: left; margin-bottom: 15px; color: #333;">
                                <li> Refresh the page and try again</li>
                                <li> Ensure all images are fully loaded</li>
                                <li> Check browser allows file downloads</li>
                                <li> Try with a different browser</li>
                            </ul>
                            <p style="font-size: 0.9em; color: #666;">Error: ${error.message || 'Unknown error'}</p>
                            <button onclick="this.parentNode.remove()" style="
                                background: #f56565; color: white; border: none; 
                                padding: 10px 20px; border-radius: 5px; cursor: pointer;
                                margin-top: 10px;
                            ">Close</button>
                        `;
                        
                        document.body.appendChild(errorDiv);
                        
                        setTimeout(() => {
                            button.innerHTML = originalContent;
                            button.disabled = false;
                            if (errorDiv.parentNode) errorDiv.remove();
                        }, 8000);
                    });
                } catch (error) {
                    console.error('PDF generation error:', error);
                    button.innerHTML = originalContent;
                    button.disabled = false;
                    alert('PDF generation failed: ' + error.message);
                }
            });
        });
        
        // Create floating particles
        function createParticles() {
            const particles = document.querySelector('.particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size between 2px and 8px
                const size = Math.random() * 6 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Random horizontal position
                particle.style.left = Math.random() * 100 + '%';
                
                // Random animation delay
                particle.style.animationDelay = Math.random() * 20 + 's';
                
                // Random animation duration
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                
                particles.appendChild(particle);
            }
        }
        
        createParticles();
        
        // Add card hover effects
        document.querySelectorAll('.card, .preview-container').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
                this.style.background = 'rgba(255, 255, 255, 0.15)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.background = 'rgba(255, 255, 255, 0.1)';
            });
        });
        
        // Add navigation hover effects
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('mouseenter', function() {
                if (!this.classList.contains('active')) {
                    this.style.transform = 'translateY(-2px) scale(1.05)';
                }
            });
            
            link.addEventListener('mouseleave', function() {
                if (!this.classList.contains('active')) {
                    this.style.transform = 'translateY(0) scale(1)';
                }
            });
        });
    </script>
        </div>
    </div>
</body>
</html>
